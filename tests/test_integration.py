import os
import sys
from dotenv import load_dotenv
import json

sys.path.insert(0, os.path.abspath(os.path.join(os.path.dirname(__file__), "..")))

from app.scraper import scrape_report_wrapper
from app.ai import GroqAIProcessor
from app.notion_client import NotionClient
from app.extractor import ContentExtractor
from app.notifier import TelegramNotifier
from app.notifier import EmailNotifier

ai_processor = GroqAIProcessor()
notion_client = NotionClient()
content_extractor = ContentExtractor()
telegram_notifier = TelegramNotifier()
email_notifier = EmailNotifier()

report_url = "https://protradingskills.com/analysis/instrucciones-antes-de-la-conferencia-de-la-fed-importante-ver-ya/"

load_dotenv()

def test_report_ai():
    print("üîç Running Integration test...")
    report = {'success': True, 'url': 'https://protradingskills.com/analysis/instrucciones-antes-de-la-conferencia-de-la-fed-importante-ver-ya/', 'title': None, 'html_content': '<h2> INSTRUCCIONES ANTES DE LA CONFERENCIA DE LA FED!! IMPORTANTE VER YA!!!</h2><p>Este mi√©rcoles es finalmente la Conferencia de la FED y la realidad es que es un momento de alta incertidumbre:</p><p>&nbsp;</p><ul><li>Un Powell suave provocar√° subidas y mayores movimientos alcistas hasta quiz√°s la segunda mitad de Agosto</li></ul><p>&nbsp;</p><ul><li>Un Powell duro provocar√° ya el inicio del retroceso ‚Äúestacional‚Äù</li></ul><p>&nbsp;</p><p>Todos los argumentos estad√≠sticos y correlativos sugieren que ya est√° el mercado listo para una correcci√≥n, pero habr√° que tener cuidado.</p><p>&nbsp;</p><ul><li>Por ello es preferible que tengan lo m√≠nimo posible o <strong>NADA </strong>en operaciones para ma√±ana ya que cualquier cosa puede ocurrir.</li></ul><p>&nbsp;</p><p>Y operamos a partir del jueves luego de pase toda la volatilidad de la FED:</p><p>&nbsp;</p><ul><li>Si Powell hace subir el mercado:&nbsp;<em>vienen entradas r√°pidas alcistas como la de QQQ en Bolsa, Options y Crypto</em></li><li>Si Powell tumba el mercado:&nbsp;<em>desde el jueves empezamos a operar a la baja SPY, Bitcoin y otros activos de los cuales mandar√≠a entradas!!</em></li></ul><p>&nbsp;</p><p>Dicho esto, el Sp500 cerr√≥ el d√≠a en futuros y en spot con toda la apariencia de estar muy cerca de una posible formaci√≥n de techo, especialmente con la ca√≠da por debajo del phy menor, donde b√°sicamente tenemos entonces una&nbsp;<em><strong>posible falsa ruptura alcista lo que significa DEBILIDAD:</strong></em></p><p>&nbsp;</p><p><img decoding="async" class="alignnone size-medium" src="https://www.tradingview.com/x/OzjSES5w/" width="1835" height="907"></p><p>&nbsp;</p><p>Adem√°s, en SPOT tambi√©n tiene una ca√≠da inferior al phy bajista menor y una envolvente bajista por lo que dir√©:</p><p>&nbsp;</p><ul><li><em>Si Powell no hace subir al mercado y el SP500 NO logra romper m√°ximos y caemos por debajo de&nbsp;<strong>6365</strong>, daremos por iniciado el proceso correctivo que tanto nos ha indicado la estad√≠stica y por ende lo siguiente ser√° operar a la baja por unas semanas antes de que haya un nuevo suelo dentro de la tendencia alcista:</em></li></ul><p><img decoding="async" class="alignnone size-medium" src="https://www.tradingview.com/x/0BzJmPau/" width="2026" height="1235"></p><p>&nbsp;</p><p>&nbsp;</p><p>Sin embargo, si hay alguien capaz de darle la vuelta a todo y permitir que el mercado suba a 6500 o a nuevos m√°ximos en Bitcoin es&nbsp;<strong>Jerome Powell</strong></p><p>&nbsp;</p><ul><li>POR LO TANTO, NO ME SIENTO C√ìMODO TENIENDO LA OPERACI√ìN DE SHORT DE BITCOIN&nbsp;<strong>ANTES DE LA CONFERENCIA DE LA FED</strong></li></ul><p>&nbsp;</p><p>Bitcoin anda con muchas mechas y activ√≥ ese peque√±o short de √∫nicamente -1% enviado en el reporte de ayer, pero en IBIT ni se ha movido a√∫n, lo cual hace que por ejemplo IBIT a√∫n no confirme ca√≠da.&nbsp;<em>Y aunque la data de an√°lisis indica mayor probabilidad de correcciones,&nbsp;<strong>LA FED Y POWELL SON CAPACES DE TODO:</strong></em></p><p>&nbsp;</p><p><img loading="lazy" decoding="async" class="alignnone size-medium" src="https://www.tradingview.com/x/IAj7hqR1/" width="3500" height="1737"></p><p>&nbsp;</p><p><em><strong>ES POR ELLO QUE COMUNICO FORMALMENTE QUE PREFIERO CERRAR EL SHORT YA EN 117.859$, EN UN LIGERO 0.33% DE DISTANCIA DEL PUNTO DE ENTRADA Y PASAR CON TRANQUILIDAD ABSOLUTA LA CONFERENCIA DE LA FED PARA EVITAR INCONVENIENTES!!</strong></em></p><p>&nbsp;</p><ul><li>Si Powell tumba el mercado:&nbsp;<em><strong>EL JUEVES POR LA MA√ëANA ENV√çO UNA NUEVA ENTRADA EN BTC YA CONFIRMADOS, adem√°s de operar SPY .. y tambi√©n IBIT y otras cosas!!</strong></em></li></ul><p>&nbsp;</p><ul><li>Si Powell hace subir el mercado:&nbsp;<em>evitamos las operaciones bajistas por un par de d√≠as m√°s, y el jueves por la ma√±ana env√≠o entradas en operaciones que den ganancias r√°pidas como QQQ</em></li></ul><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>PERO REITERO DE NUEVO POR AHORA:&nbsp;<strong>CERRAR EL SHORT DE BITCOIN POR PRECAUCI√ìN A LA CONFERENCIA DE LA FED Y A PARTIR DEL JUEVES REINICIAMOS OPERATIVA SEG√öN C√ìMO SE DEN LAS COSAS CON LA FED!!!</strong></p><p>&nbsp;</p><p>&nbsp;</p><p>Y muchas felicitaciones por las ganancias r√°pidas de QQQ, as√≠ como tantas operaciones con tanto √©xito en estos meses!!</p><p>&nbsp;</p><p>&nbsp;</p><p>(Este Mi√©rcoles daremos la <strong>ENORME SORPRESA a todos!! </strong>y Tambi√©n la mayor oportunidad de renovar o acumular meses de la historia, es la promoci√≥n m√°s grande desde que existe PTS!!)</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p><em><strong>VAMOS CON TODO!!!</strong></em></p><p>&nbsp;</p><div class="button-like like-button" id="180256" style="cursor: pointer"><div class="like-button-small-component-container false" style="pointer-events: none;"><div class="rocket">üöÄ\u200b</div><div class="likes medium-text" id="likes-180256">182</div></div></div> <script type="pmdelayedscript" data-cfasync="false" data-no-optimize="1" data-no-defer="1" data-no-minify="1">document.addEventListener("click", function(event) {\n                console.log(event.target.classList);\n                if (event.target.classList.contains("like-button")) {\n\n                    var postId = event.target.getAttribute("id");\n                    var myHeaders = new Headers();\n                    myHeaders.append("Content-Type", "application/json");\n                    myHeaders.append("X-WP-Nonce", pts.bb_nonce);\n\n                    var raw = JSON.stringify({\n                        "post_id": postId\n                    });\n\n                    var requestOptions = {\n                        method: "POST",\n                        headers: myHeaders,\n                        body: raw,\n                        redirect: "follow"\n                    };\n                    var homeUrl = window.location.protocol + "//" + window.location.host;\n                    fetch(homeUrl + "/wp-json/pts/v1/actualization/reaction", requestOptions)\n                        .then(response => response.json())\n                        .then(result => {\n\n                            console.log(result);\n                            document.getElementById("likes-" + postId).innerHTML = result["total reactions"];\n                            var firstElementChild = event.target.firstElementChild;\n                            if (firstElementChild.classList.contains("true")) {\n                                firstElementChild.classList.remove("true")\n                                firstElementChild.classList.add("false")\n                            } else if (firstElementChild.classList.contains("false")) {\n                                firstElementChild.classList.remove("false")\n                                firstElementChild.classList.add("true")\n                            }\n\n                        })\n                        .catch(error => console.log("error", error));\n                }\n            });</script> ', 'text_content': 'INSTRUCCIONES ANTES DE LA CONFERENCIA DE LA FED!! IMPORTANTE VER YA!!!\n\nEste mi√©rcoles es finalmente la Conferencia de la FED y la realidad es que es un momento de alta incertidumbre:\n\n\xa0\n\nUn Powell suave provocar√° subidas y mayores movimientos alcistas hasta quiz√°s la segunda mitad de Agosto\n\n\xa0\n\nUn Powell duro provocar√° ya el inicio del retroceso ‚Äúestacional‚Äù\n\n\xa0\n\nTodos los argumentos estad√≠sticos y correlativos sugieren que ya est√° el mercado listo para una correcci√≥n, pero habr√° que tener cuidado.\n\n\xa0\n\nPor ello es preferible que tengan lo m√≠nimo posible o NADA en operaciones para ma√±ana ya que cualquier cosa puede ocurrir.\n\n\xa0\n\nY operamos a partir del jueves luego de pase toda la volatilidad de la FED:\n\n\xa0\n\nSi Powell hace subir el mercado:\xa0vienen entradas r√°pidas alcistas como la de QQQ en Bolsa, Options y Crypto\nSi Powell tumba el mercado:\xa0desde el jueves empezamos a operar a la baja SPY, Bitcoin y otros activos de los cuales mandar√≠a entradas!!\n\n\xa0\n\nDicho esto, el Sp500 cerr√≥ el d√≠a en futuros y en spot con toda la apariencia de estar muy cerca de una posible formaci√≥n de techo, especialmente con la ca√≠da por debajo del phy menor, donde b√°sicamente tenemos entonces una\xa0posible falsa ruptura alcista lo que significa DEBILIDAD:\n\n\xa0\n\n\xa0\n\nAdem√°s, en SPOT tambi√©n tiene una ca√≠da inferior al phy bajista menor y una envolvente bajista por lo que dir√©:\n\n\xa0\n\nSi Powell no hace subir al mercado y el SP500 NO logra romper m√°ximos y caemos por debajo de\xa06365, daremos por iniciado el proceso correctivo que tanto nos ha indicado la estad√≠stica y por ende lo siguiente ser√° operar a la baja por unas semanas antes de que haya un nuevo suelo dentro de la tendencia alcista:\n\n\xa0\n\n\xa0\n\nSin embargo, si hay alguien capaz de darle la vuelta a todo y permitir que el mercado suba a 6500 o a nuevos m√°ximos en Bitcoin es\xa0Jerome Powell\n\n\xa0\n\nPOR LO TANTO, NO ME SIENTO C√ìMODO TENIENDO LA OPERACI√ìN DE SHORT DE BITCOIN\xa0ANTES DE LA CONFERENCIA DE LA FED\n\n\xa0\n\nBitcoin anda con muchas mechas y activ√≥ ese peque√±o short de √∫nicamente -1% enviado en el reporte de ayer, pero en IBIT ni se ha movido a√∫n, lo cual hace que por ejemplo IBIT a√∫n no confirme ca√≠da.\xa0Y aunque la data de an√°lisis indica mayor probabilidad de correcciones,\xa0LA FED Y POWELL SON CAPACES DE TODO:\n\n\xa0\n\n\xa0\n\nES POR ELLO QUE COMUNICO FORMALMENTE QUE PREFIERO CERRAR EL SHORT YA EN 117.859$, EN UN LIGERO 0.33% DE DISTANCIA DEL PUNTO DE ENTRADA Y PASAR CON TRANQUILIDAD ABSOLUTA LA CONFERENCIA DE LA FED PARA EVITAR INCONVENIENTES!!\n\n\xa0\n\nSi Powell tumba el mercado:\xa0EL JUEVES POR LA MA√ëANA ENV√çO UNA NUEVA ENTRADA EN BTC YA CONFIRMADOS, adem√°s de operar SPY .. y tambi√©n IBIT y otras cosas!!\n\n\xa0\n\nSi Powell hace subir el mercado:\xa0evitamos las operaciones bajistas por un par de d√≠as m√°s, y el jueves por la ma√±ana env√≠o entradas en operaciones que den ganancias r√°pidas como QQQ\n\n\xa0\n\n\xa0\n\n\xa0\n\nPERO REITERO DE NUEVO POR AHORA:\xa0CERRAR EL SHORT DE BITCOIN POR PRECAUCI√ìN A LA CONFERENCIA DE LA FED Y A PARTIR DEL JUEVES REINICIAMOS OPERATIVA SEG√öN C√ìMO SE DEN LAS COSAS CON LA FED!!!\n\n\xa0\n\n\xa0\n\nY muchas felicitaciones por las ganancias r√°pidas de QQQ, as√≠ como tantas operaciones con tanto √©xito en estos meses!!\n\n\xa0\n\n\xa0\n\n(Este Mi√©rcoles daremos la ENORME SORPRESA a todos!! y Tambi√©n la mayor oportunidad de renovar o acumular meses de la historia, es la promoci√≥n m√°s grande desde que existe PTS!!)\n\n\xa0\n\n\xa0\n\n\xa0\n\nVAMOS CON TODO!!!\n\n\xa0\n\nüöÄ\u200b\n182'}

    report = scrape_report_wrapper(report_url)




    ai_analysis = {'translated_content': 'INSTRUCTIONS BEFORE THE FED CONFERENCE!! WATCH NOW, IMPORTANT!!!\n\nThis Wednesday is finally the FED Conference and the reality is that it is a moment of high uncertainty:\n\nA dovish Powell will trigger rallies and greater upward moves perhaps until the second half of August.\n\nA hawkish Powell will already trigger the beginning of the ‚Äúseasonal‚Äù pullback.\n\nAll statistical and correlative arguments suggest that the market is already ready for a correction, but we must be careful.\n\nTherefore it is preferable that you hold the minimum possible or NOTHING in trades for tomorrow since anything can happen.\n\nAnd we trade starting on Thursday after all the FED volatility has passed:\n\nIf Powell makes the market rise: quick long entries come like QQQ in Stocks, Options and Crypto.\nIf Powell knocks the market down: starting Thursday we begin to trade downward SPY, Bitcoin and other assets for which I will send entries!\n\nThat said, the S&P 500 closed today in futures and in spot with every appearance of being very close to a possible top formation, especially with the drop below the lower phy, where basically we then have a possible false bullish breakout which means WEAKNESS:\n\nAlso, in SPOT it also has a drop below the bearish lower phy and a bearish engulfing so I will say:\n\nIf Powell does not lift the market and the S&P 500 FAILS to break highs and we fall below 6365, we will consider the corrective process started that statistics have so clearly shown us, and therefore the next step will be to trade downward for a few weeks before a new floor appears within the uptrend.\n\nHowever, if anyone is capable of turning everything around and allowing the market to rise to 6500 or to new highs in Bitcoin it is Jerome Powell.\n\nTHEREFORE, I DO NOT FEEL COMFORTABLE HOLDING THE BITCOIN SHORT TRADE BEFORE THE FED CONFERENCE.\n\nBitcoin is showing many wicks and activated that small short of only -1% sent in yesterday‚Äôs report, but in IBIT it has not even moved yet, which makes for example IBIT still not confirm the drop. And although the data from the analysis indicates a higher probability of corrections, THE FED AND POWELL ARE CAPABLE OF ANYTHING:\n\nTHAT IS WHY I FORMALLY COMMUNICATE THAT I PREFER TO CLOSE THE SHORT NOW AT $117,859, AT A SLIGHT 0.33% DISTANCE FROM THE ENTRY POINT AND GO THROUGH THE FED CONFERENCE WITH ABSOLUTE CALM TO AVOID INCONVENIENCES!!\n\nIf Powell knocks the market down: ON THURSDAY MORNING I SEND A NEW ENTRY IN BTC ALREADY CONFIRMED, besides trading SPY‚Ä¶ and also IBIT and other things!!\nIf Powell makes the market rise: we avoid bearish trades for a couple more days, and on Thursday morning I send entries in trades that give quick gains like QQQ\n\nBUT I REITERATE AGAIN FOR NOW: CLOSE THE BITCOIN SHORT AS A PRECAUTION BEFORE THE FED CONFERENCE AND STARTING THURSDAY WE RESTART OPERATIONS ACCORDING TO HOW THINGS UNFOLD WITH THE FED!!!\n\nAnd congratulations for the quick gains in QQQ, as well as so many successful trades in these months!!\n\n(This Wednesday we will give the HUGE SURPRISE to everyone!! And also the greatest opportunity to renew or accumulate months of history, it is the biggest promotion since PTS exists!!)\n\nLET‚ÄôS GO ALL IN!!!\n\nüöÄ', 'summary': 'The report centers on the imminent Federal Reserve (FOMC) press conference scheduled for Wednesday. The author argues that the market is statistically overdue for a correction, citing bearish technical signals on both the S&P 500 (close to forming a top, false breakout, bearish engulfing) and Bitcoin (multiple wicks, lack of confirmation from IBIT). Two binary outcomes are presented: (1) a dovish Powell could extend the rally into mid-August, prompting quick long trades in QQQ, options, and crypto; (2) a hawkish Powell would immediately trigger the anticipated seasonal pullback, opening short opportunities in SPY, Bitcoin, and related ETFs. The author explicitly recommends closing the existing small Bitcoin short at ~$117,859 (-0.33%) before the FOMC event to avoid headline risk. Trading is to resume on Thursday, directionally determined by Powell‚Äôs tone.', 'key_insights': ['Market structure suggests the S&P 500 is forming a local top under the lower phy level at 6365; a decisive break below this level would confirm a multi-week correction.', 'Bitcoin‚Äôs price action shows indecision (long wicks) and IBIT has not yet confirmed the bearish thesis, increasing the probability of a violent Powell-induced reversal.', 'A dovish Powell could propel the S&P 500 to 6500 or higher and Bitcoin to new highs, invalidating short-term bear setups.', 'The author is voluntarily taking a -0.33% loss on the BTC short to eliminate overnight event risk ahead of the FOMC.', 'Post-FOMC playbook is binary: (a) dovish ‚Üí rapid long QQQ/crypto trades; (b) hawkish ‚Üí initiate shorts in SPY, BTC, IBIT.', 'Volatility is expected to peak Wednesday; the author counsels minimal or zero exposure until Thursday‚Äôs directional clarity.'], 'market_metrics': {'mentioned_stocks': ['QQQ', 'SPY', 'IBIT'], 'sectors': ['Broad US Equities', 'Technology (via QQQ)', 'Bitcoin/Crypto', 'Bitcoin ETFs'], 'market_sentiment': 'negative'}, 'outlook': 'Expect a sharp directional move immediately after Powell‚Äôs press conference; if the market is not pushed higher, a correction lasting several weeks is the base case.', 'risk_factors': ['Unpredictable FED communication causing violent whipsaw', 'False breakout on S&P 500 increasing downside momentum', 'Bitcoin volatility without IBIT confirmation', 'Liquidity gaps during overnight FOMC event', 'Potential for hawkish surprise given recent inflation data'], 'action_items': ['Close Bitcoin short at $117,859 before Wednesday‚Äôs close to avoid headline risk.', 'Keep cash position or minimal exposure overnight through the FOMC meeting.', 'On Thursday morning: monitor S&P 500 reaction at the 6365 level; if it fails to hold, initiate shorts in SPY with stops above the daily high.', 'If Powell is dovish and S&P 500 breaks >6500, enter leveraged long QQQ or QQQ call options targeting quick 2-3 day gains.', 'Prepare simultaneous buy orders for IBIT and spot BTC on a hawkish-Powell dip, with entries triggered only after Thursday‚Äôs open confirms follow-through.'], 'confidence_level': 'Medium'}

    ai_analysis = ai_processor.translate_and_analyze(report["text_content"])


    full_response = content_extractor.create_summary_structure(report, ai_analysis)

    # print(json.dumps(full_response, indent=2))
#     full_response = {
#   "metadata": {
#     "title": "INSTRUCCIONES ANTES DE LA CONFERENCIA DE LA FED!! IMPORTANTE VER YA!!!",
#     "word_count": 578,
#     "timestamp": "2025-08-03 18:55:02"
#   },
#   "content": {
#     "original_text": "INSTRUCCIONES ANTES DE LA CONFERENCIA DE LA FED!! IMPORTANTE VER YA!!!\nEste mi\u00e9rcoles es finalmente la Conferencia de la FED y la realidad es que es un momento de alta incertidumbre:\nUn Powell suave provocar\u00e1 subidas y mayores movimientos alcistas hasta quiz\u00e1s la segunda mitad de Agosto\nUn Powell duro provocar\u00e1 ya el inicio del retroceso \u201cestacional\u201d\nTodos los argumentos estad\u00edsticos y correlativos sugieren que ya est\u00e1 el mercado listo para una correcci\u00f3n, pero habr\u00e1 que tener cuidado.\nPor ello es preferible que tengan lo m\u00ednimo posible o\nNADA\nen operaciones para ma\u00f1ana ya que cualquier cosa puede ocurrir.\nY operamos a partir del jueves luego de pase toda la volatilidad de la FED:\nSi Powell hace subir el mercado:\nvienen entradas r\u00e1pidas alcistas como la de QQQ en Bolsa, Options y Crypto\nSi Powell tumba el mercado:\ndesde el jueves empezamos a operar a la baja SPY, Bitcoin y otros activos de los cuales mandar\u00eda entradas!!\nDicho esto, el Sp500 cerr\u00f3 el d\u00eda en futuros y en spot con toda la apariencia de estar muy cerca de una posible formaci\u00f3n de techo, especialmente con la ca\u00edda por debajo del phy menor, donde b\u00e1sicamente tenemos entonces una\nposible falsa ruptura alcista lo que significa DEBILIDAD:\nAdem\u00e1s, en SPOT tambi\u00e9n tiene una ca\u00edda inferior al phy bajista menor y una envolvente bajista por lo que dir\u00e9:\nSi Powell no hace subir al mercado y el SP500 NO logra romper m\u00e1ximos y caemos por debajo de\n6365\n, daremos por iniciado el proceso correctivo que tanto nos ha indicado la estad\u00edstica y por ende lo siguiente ser\u00e1 operar a la baja por unas semanas antes de que haya un nuevo suelo dentro de la tendencia alcista:\nSin embargo, si hay alguien capaz de darle la vuelta a todo y permitir que el mercado suba a 6500 o a nuevos m\u00e1ximos en Bitcoin es\nJerome Powell\nPOR LO TANTO, NO ME SIENTO C\u00d3MODO TENIENDO LA OPERACI\u00d3N DE SHORT DE BITCOIN\nANTES DE LA CONFERENCIA DE LA FED\nBitcoin anda con muchas mechas y activ\u00f3 ese peque\u00f1o short de \u00fanicamente -1% enviado en el reporte de ayer, pero en IBIT ni se ha movido a\u00fan, lo cual hace que por ejemplo IBIT a\u00fan no confirme ca\u00edda.\nY aunque la data de an\u00e1lisis indica mayor probabilidad de correcciones,\nLA FED Y POWELL SON CAPACES DE TODO:\nES POR ELLO QUE COMUNICO FORMALMENTE QUE PREFIERO CERRAR EL SHORT YA EN 117.859$, EN UN LIGERO 0.33% DE DISTANCIA DEL PUNTO DE ENTRADA Y PASAR CON TRANQUILIDAD ABSOLUTA LA CONFERENCIA DE LA FED PARA EVITAR INCONVENIENTES!!\nSi Powell tumba el mercado:\nEL JUEVES POR LA MA\u00d1ANA ENV\u00cdO UNA NUEVA ENTRADA EN BTC YA CONFIRMADOS, adem\u00e1s de operar SPY .. y tambi\u00e9n IBIT y otras cosas!!\nSi Powell hace subir el mercado:\nevitamos las operaciones bajistas por un par de d\u00edas m\u00e1s, y el jueves por la ma\u00f1ana env\u00edo entradas en operaciones que den ganancias r\u00e1pidas como QQQ\nPERO REITERO DE NUEVO POR AHORA:\nCERRAR EL SHORT DE BITCOIN POR PRECAUCI\u00d3N A LA CONFERENCIA DE LA FED Y A PARTIR DEL JUEVES REINICIAMOS OPERATIVA SEG\u00daN C\u00d3MO SE DEN LAS COSAS CON LA FED!!!\nY muchas felicitaciones por las ganancias r\u00e1pidas de QQQ, as\u00ed como tantas operaciones con tanto \u00e9xito en estos meses!!\n(Este Mi\u00e9rcoles daremos la\nENORME SORPRESA a todos!!\ny Tambi\u00e9n la mayor oportunidad de renovar o acumular meses de la historia, es la promoci\u00f3n m\u00e1s grande desde que existe PTS!!)\nVAMOS CON TODO!!!\n\ud83d\ude80\u200b\n182",
#     "translated_content": "INSTRUCTIONS BEFORE THE FED CONFERENCE!! IMPORTANT TO SEE NOW!!!\n\nThis Wednesday is finally the FED Conference and the reality is that this is a moment of high uncertainty:\n\nA dovish Powell will trigger rallies and larger upward moves possibly until the second half of August.\n\nA hawkish Powell will already start the \"seasonal\" pullback.\n\nAll statistical and correlational arguments suggest that the market is ready for a correction, but caution is required.\n\nTherefore it is preferable to have as little as possible or NOTHING in open positions tomorrow since anything can happen.\n\nWe will trade starting Thursday after the FED volatility has passed:\n\nIf Powell makes the market rise: quick long entries like QQQ in Stocks, Options and Crypto.\nIf Powell crashes the market: starting Thursday we begin to trade downwards SPY, Bitcoin and other assets from which I will send entries!\n\nThat said, the S&P500 closed today in futures and spot with every appearance of being very close to a possible topping formation, especially with the fall below the minor high, where we basically have then a possible false upward breakout which means WEAKNESS:\n\nAlso, in SPOT it also has a fall below the minor bearish high and a bearish engulfing, so I will say:\n\nIf Powell does not make the market rise and the S&P500 fails to break new highs and we fall below 6365, we will consider the corrective process started which the statistics have indicated so much, and therefore the next step will be to trade downwards for a few weeks before a new floor within the uptrend:\n\nHowever, if there is someone capable of turning everything around and allowing the market to rise to 6500 or new highs in Bitcoin it is Jerome Powell.\n\nTHEREFORE, I DO NOT FEEL COMFORTABLE HOLDING THE BITCOIN SHORT POSITION BEFORE THE FED CONFERENCE.\n\nBitcoin is showing many wicks and triggered that small short of only -1% sent in yesterday's report, but IBIT has not even moved yet, which for example makes IBIT not yet confirm the decline. And although the analysis data indicates a higher probability of corrections, THE FED AND POWELL ARE CAPABLE OF ANYTHING:\n\nIT IS FOR THIS REASON THAT I FORMALLY COMMUNICATE THAT I PREFER TO CLOSE THE SHORT NOW AT $117,859, AT A SLIGHT 0.33% DISTANCE FROM THE ENTRY POINT AND TO GO THROUGH THE FED CONFERENCE WITH ABSOLUTE PEACE TO AVOID ANY INCONVENIENCE!!\n\nIf Powell crashes the market: ON THURSDAY MORNING I SEND A NEW ENTRY IN BTC ALREADY CONFIRMED, in addition to trading SPY... and also IBIT and other things!!\n\nIf Powell makes the market rise: we avoid bearish trades for a couple more days, and on Thursday morning I send entries in trades that give quick profits like QQQ.\n\nBUT ONCE AGAIN I REPEAT FOR NOW: CLOSE THE BITCOIN SHORT AS A PRECAUTION BEFORE THE FED CONFERENCE AND STARTING THURSDAY WE RESTART OPERATIONS ACCORDING TO HOW THINGS UNFOLD WITH THE FED!!!\n\nAnd congratulations for the quick profits on QQQ, as well as so many successful operations in these months!!\n\n(This Wednesday we will give the HUGE SURPRISE to everyone!! and also the biggest opportunity to renew or accumulate months of the history, it is the biggest promotion since PTS exists!!)\n\nLET'S GO FULL FORCE!!!",
#     "report_images": [
#       "https://www.tradingview.com/x/OzjSES5w/",
#       "https://www.tradingview.com/x/0BzJmPau/",
#       "https://www.tradingview.com/x/IAj7hqR1/"
#     ]
#   },
#   "analysis": {
#     "summary": "The report centers on the critical FOMC meeting scheduled for this Wednesday, framing Chair Jerome Powell\u2019s tone as the single most important catalyst for near-term market direction. All statistical models point to an imminent correction, yet the author concedes that Powell could override historical probabilities and propel the S&P 500 to 6 500 or Bitcoin to fresh highs. To avoid binary risk, the author is closing an existing 1 % Bitcoin short at ~$117 859 and will hold zero overnight exposure until after the announcement. Trading will resume Thursday with either momentum-driven longs (QQQ, crypto options) or tactical shorts (SPY, Bitcoin, IBIT) depending on Powell\u2019s guidance.",
#     "key_insights": [
#       "Powell\u2019s rhetoric on Wednesday is the dominant variable; dovishness could extend the rally into mid-August while hawkishness would immediately trigger the expected seasonal correction.",
#       "S&P 500 futures and spot closed below the prior minor high, forming a potential false breakout and bearish engulfing\u2014classic topping signals.",
#       "A decisive daily close for the S&P 500 below 6 365 will officially validate the statistical correction scenario and open a multi-week downside window.",
#       "Bitcoin is exhibiting indecisive price action with long upper wicks; IBIT has not yet confirmed the decline, increasing near-term whipsaw risk.",
#       "Author is explicitly flattening the existing \u22121 % Bitcoin short before the announcement to avoid overnight gap risk.",
#       "Post-FOMC playbook: quick momentum longs in QQQ and crypto if the market rallies; short SPY, BTC, IBIT if Powell triggers a sell-off.",
#       "High-impact promotional announcement from PTS is scheduled for Wednesday, likely timed to capitalize on the volatility surge."
#     ],
#     "market_metrics": {
#       "mentioned_stocks": [
#         "QQQ",
#         "SPY",
#         "IBIT",
#         "Bitcoin"
#       ],
#       "sectors": [
#         "Broad US Equities",
#         "Cryptocurrency",
#         "Leveraged/Inverse ETFs"
#       ],
#       "market_sentiment": "neutral"
#     },
#     "outlook": "Direction will be determined by Wednesday\u2019s FOMC; thereafter either a tactical multi-week correction (targeting lower SPX and BTC prices) or an extension of the bullish trend into August.",
#     "risk_factors": [
#       "High overnight gap risk around FOMC announcement",
#       "Potential for Powell to invalidate bearish statistical setups",
#       "Bitcoin price action showing conflicting signals (wicks vs ETF flows)",
#       "Seasonal correction window statistically overdue yet not guaranteed"
#     ],
#     "action_items": [
#       "Close all directional exposure before 2:00 p.m. ET on Wednesday\u2014hold cash or ultra-short-term hedges only.",
#       "Set conditional orders: buy QQQ call options or crypto momentum plays if Powell is dovish and SPX > 6 365 on Thursday open.",
#       "Prepare short orders on SPY, leveraged BTC products, and IBIT puts to trigger on a hawkish Powell and SPX < 6 365.",
#       "Monitor the 6 365 level on the S&P 500 futures as the binary pivot for next-week positioning.",
#       "Re-evaluate risk-reward on renewed entries only after Thursday\u2019s cash session open and after Powell\u2019s tone is fully absorbed."
#     ],
#     "confidence_level": "Medium"
#   }
# }


    # Save to Notion
    notion_result = notion_client.create_report_page(full_response, report_url)

    # notion_result = {'success': True, 'page_id': '2447583c-fef7-8173-b103-f53531e2f493', 'page_url': 'https://www.notion.so/INSTRUCCIONES-ANTES-DE-LA-CONFERENCIA-DE-LA-FED-IMPORTANTE-VER-YA-2447583cfef78173b103f53531e2f493'}
    notion_url = notion_result.get('page_url') if notion_result['success'] else None

    #  # Send Telegram notification
    telegram_success = telegram_notifier.send_notification(full_response, notion_url)
    print(telegram_success)
    # Send email
    email_success = email_notifier.send_report_email(full_response, report_url)
    print(email_success)

    
if __name__ == "__main__":
    test_report_ai()
